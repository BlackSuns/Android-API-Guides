# 概述 #

+ Fragment将应用程序的功能和UI分解成可重用的模块。
+ 添加多个Fragment来避免Activity之间的切换。
+ Fragment拥有自身的生命周期、状态和回退栈。
+ Fragment要求API 11以上（当然也可以用v4支持包）。

# 目录 #

设计哲学

创建Fragment
> 添加用户界面			
> 添加Fragment到Activity		

管理Fragment

执行Fragment事务

与Activity通信
> 创建事件回调接口		
> 添加条目到动作栏		

处理Fragment生命周期
> 与Activity生命周期间的协作

例子


# Fragments #

Fragment在Activity中表示用户界面的一个行为或者一部分。你通过在单个Activity中组合多个Fragment来创建多窗格的UI或者在多个Activity间重用Fragment。你可以将Fragment看作是Activity的一个模块，它有自身的生命周期，接收输入事件，在Activity运行时动态添加或者删除。

Fragment必须嵌入到Activity中并且它的生命周期会被Activity的生命周期直接影响。比如，Activity暂停则Activity中所有的Fragment都暂停，销毁则销毁。然而，在Activity运行时，你可以单独管理每一个Fragment，比如添加或者删除它们。当你执行这样的Fragment事务时，你也可以将Fragment添加到Activity管理的回退栈中-在Activity回退栈中的条目是Fragment事务的一条记录。回退栈运行用户通过按下返回按钮来回滚Fragment事务。

当你添加一个Fragment作为Activity布局的一部分时，Fragment存在于一个在Activity视图层级中的ViewGroup，Fragment定义了自身的布局。可以通过在Activity的布局文件中插入一个&lt;fragment&gt;节点来声明Fragment，或者通过代码将Fragment添加到已知的ViewGroup中。然而，Fragment并不一定是Activity布局中的一部分；你可能需要一个没有UI的Fragment作为Activity的工作对象。

这个文档将讨论怎样使用Fragment创建应用程序，包括Fragment在添加到回退栈时怎样管理状态，与Activity共享事件等等。


## 设计哲学 ##

Android在API 11中推出了fragment，它主要用来支持设计适用于大屏幕的更加灵活的UI界面，比如平板。由于平板的屏幕比手机大得多，所以它有更多的空间去组合UI组件。Fragment在不需要管理复杂的视图层级的情况下做到这一点。你可以通过将一个Activity的布局分拆成几个Fragment的方式在运行时动态改变Activity的外观，并可以将这些改变保存在有Activity管理的回退栈中。

例如，新闻应用程序可以在左侧使用一个Fragment来显式文章列表，在右侧使用另外一个Fragment显示文章的内容--两个Fragment并排地同时出现在一个Activity中，并且每个Fragment都有自己的生命周期回调方法，可以处理自身的输入事件。因此，与使用一个Activity选择文章，启动另一个Activity阅读文章的方式不同的是，用户可以在同一个Activity中同时完成这两件事。

你应该将Fragment设计成一个模块化和可重用的Activity组件。也就是说，因为每个Fragment都定义了自身的布局和自身的生命周期回调方法，你可以将一个Fragment添加到多个Activity中，所以你应该将Fragment设计成可重用的，并且避免Fragment之间直接通信。这个原则非常重要，因为模块化的Fragment允许根据不同屏幕大小去改变Fragment的组合方式。当你设计应用程序同时支持平板和手机时，你可以在不同的布局配置中重用Fragment，从而加强用户体验。如下图所示：
![Alt "Fragments"](../images/fragments.png)

接着讲新闻应用程序的例子，当运行在平板大小的设备上时，应用程序可以在Activity A中嵌入两个Fragment。然而，在手机大小的屏幕上，由于没有足够的空间同时容纳两个Fragment，因此Activity A只包含一个用于显示文章列表的Fragment，用户选中文章之后，启动包含用于显示文章内容的Fragment的Activity B。因此，应用程序通过在不同的组合中重用Fragment的方式来同时支持平板和手机设备。

有关如何为不同的屏幕配置设计不同的Fragment组合的更多内容，请查看[同时支持平板和手机](http://developer.android.com/guide/practices/tablets-and-handsets.html)的文档。


## 创建Fragment ##

你必须创建一个Fragment类的子类来创建Fragment。Fragment类拥有和Activity类似的代码。它包含了与Activity相似的回调方法，比如onCreate()，onStart()，onPause()和onStop()。事实上，如果将已有的应用程序转换成使用Fragment实现，你只需要将Activity回调方法的代码移到Fragment类似的回调方法中即可。

通常情况下，你至少要实现以下几个生命周期回调方法：

*onCreate()*
> 系统在创建Fragment时调用。在你的实现中，你需要初始化想要在Fragment暂停、停止然后恢复的过程中保留的关键组件。

*onCreateView()*
> 系统在Fragment第一次需要绘制用户界面时调用。为了绘制Fragment的UI，你必须返回一个作为Fragment布局的根元素的视图对象。当然，如果你的Fragment没有用户界面可以返回null。

*onPause()*
> 系统调用此方法作为用户离开Fragment的第一个迹象（尽管通常不是意味着Fragment被销毁）。你需要在这里保存当前用户会话中的数据（因为用户可能不会在回到这个Fragment）。

大部分应用程序的Fragment至少都要实现这个三个回调方法，还可以实现其它几个回调方法来处理Fragment生命周期的不同阶段。有关Fragment所有的生命周期回调方法的详细内容将会在管理Fragment生命周期一节中讨论。

![Alt "Fragment的生命周期"](../images/fragment_lifecycle.png)

这些是Fragment的子类：

*DialogFragment*
> 显示一个浮动的对话框。使用该类去创建对话框是使用Activity的对话框帮助方法的另一个很好的选择，因为你可以将Fragment对话框压入回退栈中，允许用户返回到已经撤销的对话框。

*ListFragment*
> 显示由Adapter管理的列表数据，类似于ListActivity。它提供了几个管理列表的方法，比如onListItemClick()用来处理点击事件。

*PreferenceFragment*
> 用来显示偏好设置，类似于PreferenceActivity。用来创建“设置”类型的Activity非常有用。


### 添加用户界面 ###

Fragment通常是作为Activity用户界面的一部分并将自身的布局添加到Activity中。

你必须实现onCreateView()方法来为Fragment提供布局，系统会在绘制Fragment布局时调用该方法。实现方法的返回值必须是Fragment布局的根视图。

> **注意：**如果你的Fragment是ListFragment的子类，那么你就不需要实现onCreateView()方法，因为默认的实现中已经返回了一个ListView。

为了从onCreateView()返回一个布局，你可以从定义在XML的布局资源中创建一个。onCreateView()提供了一个LayoutInflater对象。例如：

```java
public static class ExampleFragment extends Fragment {
    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {
        // Inflate the layout for this fragment
        return inflater.inflate(R.layout.example_fragment, container, false);
    }
}
```

传递给onCreateView()的container参数是插入Fragment布局的ViewGroup。savedInstanceState是提供前一个Fragment对象数据的Bundle对象。

inflate()方法需要三个参数：

+ 需要创建的布局资源ID；
+ 需要创建的布局的父ViewGroup。传递container对象给这个参数是非常重要的一个步骤，因为系统需要知道将创建好的布局添加到哪个布局中。
+ 布尔参数表示创建的布局是否附属于ViewGroup（第二个参数）。（这个情况需要传false，因为系统已经将创建的布局插入到ViewGroup中了）。

现在你已经知道如何创建Fragment的布局了，接下来，你需要将Fragment添加到Activity中。


### 添加Fragment到Activity ###

通常情况下，Fragment作为Activity的UI一部分嵌入到Activity的视图层级中。添加Fragment到Activity中有两种方式：

+ 在Activity的布局文件中声明Fragment

> ```
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:orientation="horizontal"
    android:layout_width="match_parent"
    android:layout_height="match_parent">
    <fragment android:name="com.example.news.ArticleListFragment"
            android:id="@+id/list"
            android:layout_weight="1"
            android:layout_width="0dp"
            android:layout_height="match_parent" />
    <fragment android:name="com.example.news.ArticleReaderFragment"
            android:id="@+id/viewer"
            android:layout_weight="2"
            android:layout_width="0dp"
            android:layout_height="match_parent" />
</LinearLayout>
```

> &lt;fragment&gt;节点的android:name属性指定了创建布局的Fragment类。系统在创建Activity的布局时会初始化布局文件中指定的Fragment，并调用Fragment的onCreateView()方法创建Fragment的布局。系统将Fragment返回的视图插入到&lt;fragment&gt;节点的位置。

> **注意：**每个Fragment都要求提供一个唯一的ID，如果Activity重新启动，系统会根据提供的ID恢复相应的Fragment。有三种方式可以为Fragment提供ID：
- android:id属性提供唯一的ID
- android:tag属性提供唯一的标签
- 如果以上两个属性都没有提供，系统会使用Fragment的容器视图的ID

+ 使用代码将Fragment添加到已存在的ViewGroup

> 在Activity运行期间，只需要指定放置Fragment的ViewGroup就可以动态添加Fragment到Activity的布局中。
你必须使用FragmentTransaction的API来执行Fragment事务。FragmentTransaction的实例可以通过Activity获得：

> ```java
FragmentManager fragmentManager = getFragmentManager()
FragmentTransaction fragmentTransaction = fragmentManager.beginTransaction();
```

> 然后使用add(containerViewId, fragment)方法将Fragment添加添加到指定的ViewGroup中：

> ```java
ExampleFragment fragment = new ExampleFragment();
fragmentTransaction.add(R.id.fragment_container, fragment);
fragmentTransaction.commit();
```

> add()方法的第一个参数是添加Fragment的ViewGroup的ID，第二个参数是需要添加的Fragment实例。			

> 一旦使用了FragmentTransaction改变布局，你都必须在最后调用commit()方法来使这些变化产生效果，也就是提交Fragment事务。


# 原文地址 #

<http://developer.android.com/guide/components/fragments.html>

